<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#030712"> 
    <meta name="google" content="notranslate"> 
    <title>Text2 - Translate | AI Power</title>
    <meta name="description" content="AI Translation by Text2.pro">
    <link rel="icon" type="image/png" sizes="32x32" href="https://translate.text2.pro/favicon-32x32.png">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        gray: {
                            950: '#030712', // Custom dark bg
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <style>
        /* Reset & Base */
        :root {
            --app-height: 100dvh; /* Dynamic Viewport Height for mobile */
        }
        body {
            height: var(--app-height);
            overflow: hidden; /* Prevent body scroll, handle inside elements */
            background-color: #030712;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Custom Scrollbar */
        textarea::-webkit-scrollbar { width: 4px; }
        textarea::-webkit-scrollbar-track { background: transparent; }
        textarea::-webkit-scrollbar-thumb { background-color: rgba(75, 85, 99, 0.5); border-radius: 20px; }

        /* Hide default select arrow */
        select {
            appearance: none;
            -webkit-appearance: none;
            background-color: transparent;
        }

        /* Animation classes */
        .press-effect:active { transform: scale(0.96); }
        
        /* Custom Select Wrapper Styling */
        .lang-pill {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .lang-pill select {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            cursor: pointer;
        }
        
        /* Input/Output Area Transition */
        .input-area { transition: border-color 0.3s ease; }
        .input-area:focus-within { border-color: rgba(59, 130, 246, 0.5); }

        /* Loading Spinner */
        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 0.8s ease-in-out infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>

<body class="text-gray-200 flex flex-col">

    <!-- 1. Header: Minimal & Clean -->
    <header class="flex justify-between items-center px-5 py-3 bg-gray-950/90 backdrop-blur-md border-b border-gray-800 z-20 flex-shrink-0">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-blue-600 to-purple-600 p-0.5 shadow-lg shadow-blue-900/20">
                <img src="https://translate.text2.pro/favicon.ico" alt="Logo" class="w-full h-full rounded-md object-cover bg-black">
            </div>
            <span class="font-bold text-lg tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-400">Text2 AI</span>
        </div>
        <div class="text-xs text-gray-500 font-medium px-2 py-1 rounded-full bg-gray-900 border border-gray-800">PRO</div>
    </header>

    <!-- 2. Language Bar: Sticky & Accessible -->
    <div class="bg-gray-900/50 backdrop-blur-sm border-b border-gray-800 p-2 flex items-center justify-between gap-2 z-10 flex-shrink-0">
        
        <!-- Source Language -->
        <div class="lang-pill flex-1 bg-gray-800 hover:bg-gray-700 text-gray-300 rounded-xl h-10 transition-colors relative overflow-hidden group">
            <span id="sourceLangDisplay" class="pointer-events-none font-medium text-sm truncate px-4 text-center w-full">Vietnamese</span>
            <svg class="w-3 h-3 absolute right-3 text-gray-500 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            <select id="sourceLanguageSelect">
                <!-- Options via JS -->
            </select>
        </div>

        <!-- Swap Button -->
        <button id="swapButton" class="flex-shrink-0 w-10 h-10 flex items-center justify-center rounded-full bg-gray-800 text-blue-400 hover:bg-gray-700 hover:text-blue-300 transition-all active:rotate-180 duration-300 shadow-sm border border-gray-700/50">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path></svg>
        </button>

        <!-- Target Language -->
        <div class="lang-pill flex-1 bg-gray-800 hover:bg-gray-700 text-blue-300 rounded-xl h-10 transition-colors relative overflow-hidden group">
            <span id="targetLangDisplay" class="pointer-events-none font-medium text-sm truncate px-4 text-center w-full">English</span>
            <svg class="w-3 h-3 absolute right-3 text-blue-500/50 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            <select id="targetLanguageSelect">
                <!-- Options via JS -->
            </select>
        </div>
    </div>

    <!-- 3. Main Content: Split View Layout -->
    <main class="flex-1 flex flex-col relative overflow-hidden">
        
        <!-- Top Half: Input -->
        <div class="flex-1 flex flex-col relative group input-area border-b border-gray-800">
            <div class="absolute top-2 right-2 z-10">
                <button id="clearButton" class="p-2 text-gray-500 hover:text-white hidden bg-gray-900/80 rounded-full backdrop-blur">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <textarea id="inputText" class="w-full h-full bg-transparent p-5 text-lg md:text-xl text-gray-100 resize-none focus:outline-none placeholder-gray-600" placeholder="Enter text here..."></textarea>
            
            <div class="flex justify-between items-center px-4 py-2 bg-transparent">
                <span id="charCount" class="text-xs text-gray-600 font-mono">0/500</span>
                <!-- Optional: Paste button could go here -->
            </div>
        </div>

        <!-- Divider with Pulse Effect (Visual only) -->
        <div class="h-[1px] w-full bg-gradient-to-r from-transparent via-blue-900/50 to-transparent"></div>

        <!-- Bottom Half: Output -->
        <div class="flex-1 flex flex-col bg-gray-900/30 relative">
            <div class="absolute top-0 left-0 w-full h-full bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iMSIgY3k9IjEiIHI9IjEiIGZpbGw9InJnYmEoNDUsIDU1LCA4MCwgMC4xKSIvPjwvc3ZnPg==')] opacity-30 pointer-events-none"></div>
            
            <textarea id="outputText" readonly class="w-full h-full bg-transparent p-5 text-lg md:text-xl text-blue-100 resize-none focus:outline-none placeholder-gray-700/50" placeholder="Translation..."></textarea>

            <!-- Output Actions -->
            <div class="absolute bottom-2 right-2 flex gap-2">
                <button id="copyButton" class="p-2.5 rounded-full bg-gray-800 text-gray-400 border border-gray-700 hover:text-white hover:border-gray-500 shadow-lg active:scale-95 transition-all">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                </button>
            </div>
        </div>

        <!-- Error Message Toast -->
        <div id="errorMessage" class="absolute top-4 left-1/2 transform -translate-x-1/2 bg-red-500/90 text-white text-sm py-2 px-4 rounded-full shadow-xl backdrop-blur hidden z-50 transition-all duration-300">
            Error message here
        </div>
    </main>

    <!-- 4. Footer Action Bar: Thumb-Friendly -->
    <div class="p-4 bg-gray-950/80 backdrop-blur-lg border-t border-gray-800/50 z-20 pb-safe">
        <button id="translateButton" class="w-full h-14 rounded-2xl bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold text-lg shadow-lg shadow-blue-900/30 flex items-center justify-center gap-2 press-effect transition-all hover:shadow-blue-600/40">
            <span id="buttonIcon">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"></path></svg>
            </span>
            <span id="buttonText">Translate</span>
            <div id="loadingSpinner" class="spinner hidden"></div>
        </button>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- CONSTANTS & CONFIG ---
        const workerUrl = "https://cloudflare-llm.text2team.workers.dev"; 
        const MAX_CHARS = 500;
        const supportedLanguages = {
            'auto': 'Auto Detect',
            'vi': 'Vietnamese',
            'en': 'English',
            'zh': 'Chinese',
            'ja': 'Japanese',
            'ko': 'Korean',
            'fr': 'French',
            'de': 'German',
            'es': 'Spanish',
            'ru': 'Russian',
            'th': 'Thai',
            'id': 'Indonesian',
        };

        // --- DOM ELEMENTS ---
        const elements = {
            input: document.getElementById('inputText'),
            output: document.getElementById('outputText'),
            btnTranslate: document.getElementById('translateButton'),
            btnSwap: document.getElementById('swapButton'),
            btnCopy: document.getElementById('copyButton'),
            btnClear: document.getElementById('clearButton'),
            selectSource: document.getElementById('sourceLanguageSelect'),
            selectTarget: document.getElementById('targetLanguageSelect'),
            displaySource: document.getElementById('sourceLangDisplay'),
            displayTarget: document.getElementById('targetLangDisplay'),
            charCount: document.getElementById('charCount'),
            spinner: document.getElementById('loadingSpinner'),
            btnText: document.getElementById('buttonText'),
            btnIcon: document.getElementById('buttonIcon'),
            errorMsg: document.getElementById('errorMessage'),
        };

        // --- INITIALIZATION ---
        function init() {
            // Populate Selects
            populateSelect(elements.selectSource, true);
            populateSelect(elements.selectTarget, false);
            
            // Set Defaults
            elements.selectSource.value = 'vi';
            elements.selectTarget.value = 'en';
            updateDisplays();

            // Add Event Listeners
            setupListeners();
            
            // Mobile viewport fix
            setAppHeight();
            window.addEventListener('resize', setAppHeight);
        }

        function populateSelect(selectElement, includeAuto) {
            const fragment = document.createDocumentFragment();
            for (const [code, name] of Object.entries(supportedLanguages)) {
                if (!includeAuto && code === 'auto') continue;
                const option = document.createElement('option');
                option.value = code;
                option.textContent = name;
                fragment.appendChild(option);
            }
            selectElement.appendChild(fragment);
        }

        function setupListeners() {
            // Language Changes
            elements.selectSource.addEventListener('change', updateDisplays);
            elements.selectTarget.addEventListener('change', updateDisplays);

            // Swap
            elements.btnSwap.addEventListener('click', handleSwap);

            // Text Input
            elements.input.addEventListener('input', handleInput);
            
            // Clear
            elements.btnClear.addEventListener('click', () => {
                elements.input.value = '';
                elements.output.value = '';
                handleInput();
                elements.input.focus();
            });

            // Copy
            elements.btnCopy.addEventListener('click', handleCopy);

            // Translate Action
            elements.btnTranslate.addEventListener('click', handleTranslate);
            
            // Ctrl+Enter Shortcut
            elements.input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
                    elements.btnTranslate.click();
                }
            });
        }

        // --- LOGIC FUNCTIONS ---

        function setAppHeight() {
            document.documentElement.style.setProperty('--app-height', `${window.innerHeight}px`);
        }

        function updateDisplays() {
            const sText = elements.selectSource.options[elements.selectSource.selectedIndex].text;
            const tText = elements.selectTarget.options[elements.selectTarget.selectedIndex].text;
            
            elements.displaySource.textContent = sText;
            elements.displayTarget.textContent = tText;
        }

        function handleSwap() {
            const oldSource = elements.selectSource.value;
            const oldTarget = elements.selectTarget.value;

            // Animation for swap button
            elements.btnSwap.style.transform = 'rotate(180deg)';
            setTimeout(() => elements.btnSwap.style.transform = 'rotate(0deg)', 300);

            if (oldSource !== 'auto') {
                elements.selectSource.value = oldTarget;
                elements.selectTarget.value = oldSource;
                
                // Swap content
                const tempText = elements.input.value;
                elements.input.value = elements.output.value;
                elements.output.value = tempText;
                
                handleInput(); // Update char count
            } else {
                // If auto, just set source to target's value
                elements.selectSource.value = oldTarget;
            }
            updateDisplays();
        }

        function handleInput() {
            const len = elements.input.value.length;
            elements.charCount.textContent = `${len}/${MAX_CHARS}`;
            
            // Toggle Clear Button
            elements.btnClear.style.display = len > 0 ? 'block' : 'none';

            // Validation Visuals
            if (len > MAX_CHARS) {
                elements.charCount.classList.add('text-red-500');
                elements.input.value = elements.input.value.substring(0, MAX_CHARS);
            } else {
                elements.charCount.classList.remove('text-red-500');
            }
        }

        async function handleCopy() {
            const text = elements.output.value;
            if (!text) return showError("Nothing to copy!");
            
            try {
                await navigator.clipboard.writeText(text);
                const originalIcon = elements.btnCopy.innerHTML;
                // Success Icon (Checkmark)
                elements.btnCopy.innerHTML = `<svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>`;
                elements.btnCopy.classList.add('bg-green-500/10', 'border-green-500/50');
                
                setTimeout(() => {
                    elements.btnCopy.innerHTML = originalIcon;
                    elements.btnCopy.classList.remove('bg-green-500/10', 'border-green-500/50');
                }, 1500);
            } catch (err) {
                showError("Failed to copy");
            }
        }

        function showError(msg) {
            elements.errorMsg.textContent = msg;
            elements.errorMsg.classList.remove('hidden');
            elements.errorMsg.style.opacity = '1';
            setTimeout(() => {
                elements.errorMsg.style.opacity = '0';
                setTimeout(() => elements.errorMsg.classList.add('hidden'), 300);
            }, 3000);
        }

        function toggleLoading(isLoading) {
            elements.btnTranslate.disabled = isLoading;
            if (isLoading) {
                elements.spinner.style.display = 'block';
                elements.btnText.style.display = 'none';
                elements.btnIcon.style.display = 'none';
                elements.btnTranslate.classList.add('opacity-80', 'cursor-wait');
            } else {
                elements.spinner.style.display = 'none';
                elements.btnText.style.display = 'block';
                elements.btnIcon.style.display = 'block';
                elements.btnTranslate.classList.remove('opacity-80', 'cursor-wait');
            }
        }

        // --- API LOGIC ---
        async function handleTranslate() {
            const text = elements.input.value.trim();
            if (!text) return showError("Please enter some text");
            
            // Dismiss Keyboard on Mobile
            elements.input.blur();

            toggleLoading(true);
            elements.output.value = '';

            const sText = elements.selectSource.value === 'auto' 
                ? 'detected language' 
                : elements.selectSource.options[elements.selectSource.selectedIndex].text;
            const tText = elements.selectTarget.options[elements.selectTarget.selectedIndex].text;

            const prompt = `translate this text from ${sText} to ${tText} with context-aware natural language translation style and only respond with the result, respond in that country's language, no additional explanation, only the translated text, translate: (${text})`;

            try {
                const response = await fetch(workerUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: prompt })
                });

                if (!response.ok) throw new Error("Network response was not ok");

                const data = await response.json();
                let translatedText = data?.reply?.response || data?.reply || "Translation failed";
                
                // Cleanup think tags if any
                translatedText = translatedText.replace(/<think>.*?<\/think>/gs, '').trim();
                
                elements.output.value = translatedText;

            } catch (error) {
                console.error(error);
                showError("Connection failed. Try again.");
            } finally {
                toggleLoading(false);
            }
        }

        // Run Init
        document.addEventListener('DOMContentLoaded', init);

    </script>
</body>
</html>